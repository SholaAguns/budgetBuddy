{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
<div class="container budget_heading" >
        <h2 id="budgetname" >{{budget.name}}</h2>
</div>

  <!-- Budget Balance Summary -->
  <div class="container mt-4 mb-4" align="center">
    <div class="card" style="max-width: 500px; margin: 0 auto;">
      <div class="card-header">
        <h5 class="mb-0">Budget Summary</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-6">
            <div class="text-center">
              <h6>Total Earnings</h6>
              <span class="badge bg-success fs-6">${{ total_earnings|floatformat:2 }}</span>
              <br>
              <small class="text-muted">{{ earnings_percentage|floatformat:1 }}%</small>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <h6>Total Expenses</h6>
              <span class="badge bg-danger fs-6">${{ total_expenses|floatformat:2 }}</span>
              <br>
              <small class="text-muted">{{ expenses_percentage|floatformat:1 }}%</small>
            </div>
          </div>
        </div>
        <hr>
        <div class="text-center">
          <h5>Net Balance</h5>
          {% if budget_balance >= 0 %}
            <h3 class="text-success">
              <i class="bi bi-arrow-up-circle-fill"></i>
              +${{ budget_balance|floatformat:2 }}
            </h3>
            <small class="text-muted">Surplus</small>
          {% else %}
            <h3 class="text-danger">
              <i class="bi bi-arrow-down-circle-fill"></i>
              -${{ budget_balance_abs|floatformat:2 }}
            </h3>
            <small class="text-muted">Deficit</small>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
<div class="container" align="center" >
    <table class="table table-striped">
      <thead class="table-dark">
        <tr>
            <th>Earning</th>
            <th>Amount</th>
            <th></th>
        </tr>
      </thead>
      <tbody>
        {% for budget_category in budget.budgetcategory_set.all %}
            {% if budget_category.is_earning %}
            <tr>
                <td>{{ budget_category.category}} </td>
                <td>{{ budget_category.limit}} </td>
                <td>
                    <a href="{% url 'budgets:update_budget_category' pk=budget_category.id %}"><i class="bi bi-pencil"></i></a>
                    <a href="{% url 'budgets:delete_budget_category' pk=budget_category.id %}"><i class="bi bi-trash3"></i></a>
                </td>
            </tr>
            {% endif %}
        {% endfor %}
                <tr class="table-dark">
                    <td>Total</td>
                    <td>{{ total_earnings |floatformat:2}}</td>
                    <td></td>
                </tr>
      </tbody>

  </table><hr>
  <table class="table table-striped">
      <thead class="table-dark">
        <tr>
            <th>Expense</th>
            <th>Amount</th>
            <th></th>
        </tr>
      </thead>
      <tbody>
        {% for budget_category in budget.budgetcategory_set.all %}
            {% if not budget_category.is_earning %}
               <tr>
                <td>{{ budget_category.category}} </td>
                <td>{{ budget_category.limit}} </td>
                <td>
                    <a href="{% url 'budgets:update_budget_category' pk=budget_category.id %}"><i class="bi bi-pencil"></i></a>
                    <a href="{% url 'budgets:delete_budget_category' pk=budget_category.id %}"><i class="bi bi-trash3"></i></a>
                </td>
              </tr>
            {% endif %}
        {% endfor %}
                <tr class="table-dark">
                    <td>Total</td>
                    <td>{{ total_expenses |floatformat:2 }}</td>
                    <td></td>
                </tr>
      </tbody>

  </table>


    {% if user.is_authenticated and budget.user == user %}
        <div id="budget_controls" class="container" align="center">
        <br><br>
        <a href="{% url 'budgets:add_budget_category' pk=budget.id %}" role="button" class="btn btn-outline-secondary w-80">Add Category</a>
        <a href="{% url 'budgets:update_budget' pk=budget.id %}" role="button" class="btn btn-outline-secondary  w-80">Edit Budget</a>
        <a href="{% url 'budgets:duplicate_budget' pk=budget.id %}" role="button" class="btn btn-outline-secondary  w-80">Duplicate Budget</a>
        {% if budget.is_archived %}
            <a href="{% url 'budgets:toggle_archive_budget' pk=budget.id %}" role="button" class="btn btn-outline-info  w-80">Unarchive Budget</a>
        {% else %}
            <a href="{% url 'budgets:toggle_archive_budget' pk=budget.id %}" role="button" class="btn btn-outline-warning  w-80">Archive Budget</a>
        {% endif %}
        <a href="{% url 'budgets:delete_budget' pk=budget.id %}" role="button" class="btn btn-outline-danger  w-80">Delete Budget</a>
        </div><br><br>
    {% endif %}
</div>
{% endblock %}
